# 医院地图增强箭头路径可视化指南

## 功能概述

本系统为医院Gazebo仿真环境提供地面路径可视化功能，路径以地面贴花/涂色方式显示，不影响机器人正常运动。

## 核心特性

- ✅ **纯地面路径**：路径完全贴地显示，不影响机器人运动
- ✅ **直线连接**：路径点间仅显示直线段
- ✅ **增强箭头系统**：多种类型箭头指示方向和关键点
- ✅ **无圆形节点**：完全移除所有圆盘/圆环标记
- ✅ **高可见性**：鲜明色彩确保医院环境中清晰可见

## 箭头类型说明

### 关键点箭头
- **起点箭头**：绿色，较大（1.5m），标识路径起始位置
- **终点箭头**：红色，最大（2.0m），标识路径终点位置  
- **转弯箭头**：橙色，中等（1.2m），标识路径转弯点（8度以上转角）

### 方向指示箭头
- **间隔箭头**：浅蓝色，较小（0.8m），长直线段中每3m间隔显示
- **自动生成**：仅在超过4.5m的直线段中自动添加

## 使用方法

### 1. 启动路径可视化节点
```bash
ros2 run fishbot_application path_visualizer
```

### 2. 发送路径点
```bash
ros2 topic pub /path_points geometry_msgs/msg/PoseArray "
header:
  frame_id: 'map'
poses:
- position: {x: 0.0, y: 0.0, z: 0.0}
- position: {x: 5.0, y: 0.0, z: 0.0}
- position: {x: 5.0, y: 3.0, z: 0.0}
"
```

### 3. 显示路径
```bash
# 显示涂色地板路径（推荐用于医院环境）
ros2 service call /show_painted_floor_path std_srvs/srv/Empty

# 显示地面贴花路径（备用方案）
ros2 service call /show_floor_path std_srvs/srv/Empty
```

### 4. 路径管理
```bash
# 隐藏路径
ros2 service call /hide_path std_srvs/srv/Empty

# 清除路径
ros2 service call /clear_path std_srvs/srv/Empty
```

## 快速测试

### 基础测试
```bash
./test_painted_path.sh
```

### 增强箭头测试
```bash
./test_enhanced_arrows.sh
```

## 路径样式详解

### 涂色地板路径（推荐）
- **底层基色**：蓝色涂漆效果（0.6m宽）
- **中央引导线**：白色中心线（0.1m宽）
- **边缘虚线**：深蓝色边界线（0.05m宽）
- **厚度**：0.0001m（极薄贴地）

### 地面贴花路径（备用）
- **箭头贴花**：每段路径末端显示方向箭头
- **双层设计**：基础色+高亮层
- **厚度**：0.0005m（薄贴地）

## 系统架构

```
PathVisualizerNode
├── 路径接收：/path_points (PoseArray)
├── 服务接口：
│   ├── /show_painted_floor_path
│   ├── /show_floor_path  
│   ├── /hide_path
│   └── /clear_path
├── 核心功能：
│   ├── 转弯点检测（8度敏感度）
│   ├── 间隔箭头生成（3m间隔）
│   ├── 地面路径渲染
│   └── Gazebo实体管理
└── 状态发布：/path_status (String)
```

## 医院环境优化

- **高对比度**：蓝白配色方案适合医院环境
- **无障碍设计**：地面贴花不影响轮椅、担架通行
- **方向清晰**：多层次箭头系统确保导航明确
- **易于清理**：虚拟路径可随时隐藏/清除

## 故障排除

### 路径不显示
1. 检查Gazebo是否运行
2. 确认节点已启动：`ros2 node list`
3. 验证路径点数据：`ros2 topic echo /path_points`

### 箭头位置不准确  
1. 检查转弯检测敏感度设置（当前8度）
2. 确认路径点间距是否合理
3. 验证坐标系设置（frame_id: 'map'）

### 性能问题
1. 减少路径点数量
2. 增大间隔箭头间距
3. 使用简化渲染模式

## 参数配置

可在代码中调整的关键参数：
- `转弯检测角度`：math.radians(8) 
- `间隔箭头距离`：3.0m
- `路径宽度`：0.6m
- `箭头大小`：起点1.5m，终点2.0m，转弯1.2m，间隔0.8m

## 技术特性

### 高度层级
- 地面路径：0.0001m（贴地）
- 间隔箭头：0.0015m
- 转弯箭头：0.002m（最高，确保可见性）

### 颜色编码
- 起点：rgb(0,1,0) 绿色
- 终点：rgb(1,0,0) 红色  
- 转弯：rgb(1,0.5,0) 橙色
- 间隔：rgb(0.3,0.7,1) 浅蓝色
- 路径：rgb(0.2,0.6,1) 蓝色

### 智能检测
- 自动识别8度以上转角
- 智能生成间隔箭头（仅长直线段）
- 动态箭头大小调整
